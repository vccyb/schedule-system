# 简单排课系统 - 授权码生成工具使用说明

## 工具介绍

`auth-generator.cjs` 是简单排课系统的授权码生成工具，专供开发者使用。该工具使用与系统完全相同的加密算法，确保生成的授权码能够正确验证。

## 基本用法

### 1. 生成当前月份授权码（最常用）

```bash
node auth-generator.cjs
```

生成当前月份的通用专业版授权码，包含完整的验证信息。

### 2. 生成指定月份授权码

```bash
node auth-generator.cjs --month 2024-12
```

为指定月份生成授权码，格式：YYYY-MM

### 3. 生成专属用户授权码

```bash
node auth-generator.cjs --user 张三
```

为特定用户生成专属授权码，用户必须提供相同的用户标识才能使用。

### 4. 验证授权码

```bash
node auth-generator.cjs --test GN0/-LT2J
```

验证指定授权码的有效性，支持专属用户授权码验证：

```bash
node auth-generator.cjs --test GN0/-LT2J 张三
```

### 5. 显示帮助信息

```bash
node auth-generator.cjs --help
```

## 授权码特性

### 统一授权模式

- **一个授权码解锁所有专业版功能**
- 智能排课、导出功能、高级统计、批量导入
- 简化用户体验，便于销售管理

### 安全性设计

- 基于年月+盐值的SHA-256加密算法
- 每月自动更新，无法跨月使用
- 支持专属用户绑定，防止滥用

### 授权码格式

- 格式：`XXXX-XXXX`（8位字母数字组合）
- 示例：`GN0J-LT2K`, `AB12-CD34`
- 不区分大小写，支持自动格式化

## 商业化流程

### 销售流程

1. **用户体验**：用户使用免费功能（教师管理、班级管理、手动排课等）
2. **需求产生**：用户尝试使用付费功能时看到授权提示
3. **联系购买**：用户联系微信 13170906656 咨询专业版
4. **生成授权码**：使用工具生成当月授权码提供给用户
5. **用户激活**：用户在"授权管理"页面输入授权码
6. **功能解锁**：所有专业版功能立即可用

### 定价建议

- **专业版套餐**：统一定价，包含所有高级功能
- **按月订阅**：每月需要重新购买授权码
- **灵活定价**：可根据用户类型（个人/机构）调整价格

## 验证逻辑说明

### 加密算法

```javascript
const SECRET_SALT = 'SIMPLE_SCHEDULE_PRO_2024_VccYb_Auth_System'
const PRO_FEATURE_KEY = 'pro_all_features'
const rawString = `${SECRET_SALT}:${yearMonth}:${PRO_FEATURE_KEY}:${userSeed}`
const hash = CryptoJS.SHA256(rawString).toString(CryptoJS.enc.Base64)
```

### 一致性保证

- 工具使用的算法与系统 `src/utils/auth.ts` 完全一致
- 密钥、盐值、加密方式完全相同
- 支持相同的用户标识绑定机制

### 有效期验证

- 只能验证当前月份的授权码
- 自动计算剩余有效天数
- 过期授权码会被自动拒绝

## 系统集成测试

### 测试步骤

1. 使用工具生成当前月份授权码
2. 在系统"授权管理"页面输入授权码
3. 验证以下付费功能是否可正常使用：
   - 智能排课（Dashboard和Schedule页面）
   - 导出功能（Timetable页面的Excel/PDF导出）
   - 其他专业版功能

### 预期结果

- ✅ 授权码验证成功
- ✅ 所有付费功能解锁
- ✅ 功能按钮不再显示"付费"标签
- ✅ 点击功能直接执行，不跳转授权页面

## 故障排除

### 常见问题

**1. 运行时提示 "require is not defined"**

- 确保使用 `.cjs` 扩展名
- 或在package.json中移除 `"type": "module"`

**2. 提示缺少 crypto-js 依赖**

```bash
npm install crypto-js
```

**3. 授权码验证失败**

- 检查系统时间是否正确
- 确认授权码格式是否完整
- 验证用户标识是否匹配

**4. 生成的授权码在系统中无效**

- 确认工具和系统使用相同的SECRET_SALT
- 检查两边的算法逻辑是否一致
- 验证时间计算是否相同

## 安全注意事项

1. **保密工具**：此工具仅供开发者使用，不要向用户公开
2. **密钥保护**：SECRET_SALT 和加密算法需要保密
3. **访问控制**：建议定期更换生成算法以提高安全性
4. **版本控制**：不要将此工具提交到公共代码仓库

## 更新记录

- **v1.0**：初始版本，支持统一授权码生成和验证
- 支持当前月份、指定月份、专属用户授权码生成
- 内置验证功能，确保生成的授权码有效性
- 完整的命令行参数支持
